const mongoose = require("mongoose");const express = require("express");const CustomError = require('./errors/CustomError');const config = require("./options/server");const nodemailer = require('nodemailer');const app = express();mongoose	.connect(		config.localDB,		{useNewUrlParser: true, useCreateIndex: true}	)	.catch(err => {		console.log(err);		process.exit(1);	});app.use(express.static(__dirname));app.use(express.json());app.use(express.urlencoded({extended: true}));app.use((req, res, next) => {	res.header("Access-Control-Allow-Origin", "*");	res.header(		"Access-Control-Allow-Headers",		"Origin, X-Requested-Width, Content-Type, Accept"	);	res.header('Access-Control-Allow-Methods: GET, POST, PATCH, PUT, DELETE, OPTIONS');	res.header(		"Access-Control-Expose-Headers",		"Content-Type, Content-Disposition"	);	next();});app.listen(config.port);const trains = [	{		station: 'Львів',		number: '235Ш',		route: 'Ужгород → Київ',		arriveAt: '23.48',		stops: '20 хв',		departure: '00.08'	},	{		station: 'Львів',		number: '668К',		route: 'Ковель → Львів',		arriveAt: '00.32',		stops: '20 хв',		departure: '18.10'	},	{		station: 'Львів',		number: '668К',		route: 'Ковель → Чернівці',		arriveAt: '00.32',		stops: '29 хв',		departure: '01.01'	},	{		station: 'Львів',		number: '007Л',		route: 'Івано-Франківськ → Київ',		arriveAt: '23.48',		stops: '20 хв',		departure: '00.08'	},	{		station: 'Львів',		number: '107Л',		route: 'Ужгород → Одеса',		arriveAt: '02.20',		stops: '33 хв',		departure: '02.53'	},	{		station: 'Ковель',		number: '142П',		route: 'Бахмут → Львів',		arriveAt: '00.13',		stops: '5 хв',		departure: '00.18'	},	{		station: 'Ковель',		number: '142П',		route: 'Красний Лиман → Львів',		arriveAt: '00.28',		stops: '5 хв',		departure: '00.33'	},	{		station: 'Ковель',		number: '751Ш',		route: 'Здолбунів → Хелм',		arriveAt: '00.28',		stops: '5 хв',		departure: '00.33'	},	{		station: 'Ковель',		number: '752Ш',		route: 'Хелм → Здолбунів',		arriveAt: '18.30',		stops: '20 хв',		departure: '18.50'	},	{		station: 'Київ',		number: '6601',		route: 'Київ → Коростень',		arriveAt: '03.12',		stops: '2 хв',		departure: '03.14'	},	{		station: 'Київ',		number: '6002',		route: 'Фастів → Київ',		arriveAt: '05.12',		stops: '3 хв',		departure: '05.15'	},	{		station: 'Київ',		number: '6003-6203',		route: 'Київ → Козятин',		arriveAt: '07.07',		stops: '1 хв',		departure: '07.08'	}];app.get('/time-table', ({ query : date}, res) => {	console.log(date);	res.send(trains);});app.post('/send-message', ({ body : { email }}, res) => {	let transporter = nodemailer.createTransport({		service: 'gmail',		port: 3000,		secure: true,		auth: {			type: 'OAuth2',			user: 'dmytrolitvinchuk2108@gmail.com',			clientId: '301105742201-nfp4c1a6dieund2okv43jfofc1v88p2i.apps.googleusercontent.com',			clientSecret: 'VChFANU9JgXBzMlNa6DYR9m2',			refreshToken: '1/tlJau2F8zx6FhlHRFNySohRpwaY8lHDsAx9GmK3fc2Y',			access_token: "ya29.GlvHBo3widrXLhQBR0Ax9TQBpMHQJ5kJkbx2xB-KCbeEC0u5r8-lcL44-RoP4seooB9PuRQ0pgGvVAdF_kuZ_W_617Eim5xVY0GLjNp3MN-UImF3q4EsX23O_DoZ"		},		tls: {			rejectUnauthorized: false		}	});	console.log(email);	let mailOptions = {		from: 'dmytrolitvinchuk2108@gmail.com',		to: email,		subject: 'Nodemailer test',		html: `<p>Ми відправили вам імейл</p>`,	};	const promise = new Promise((resolve, rejected) => {		transporter.sendMail(mailOptions, (err) => {			if (err) {				console.log('Error ' + err.message);				rejected(new CustomError("Cant send email", "404"));			} else {				resolve({					success: true,					message: `Лист відправлено на ваш імейл : ${email}!`				});			}		});	});	promise.then(data => {		res.send(data)	});});console.log(`all okay`);console.log(`server start on port: ${config.port}`);console.log(`address in browser: localhost:${config.port}`);module.exports = app;